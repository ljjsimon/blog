---
title: php面试题
date: 2019-08-05 11:50:39
tags: php
id: 1564977130
---
# php7 为什么比 php5 快

减少内存分配次数，多使用栈内存，缓存数组hash值，字符串解析成参数改为宏展开，使用大块连续内存代替小块碎片内存等等。

PHP7卓越性能背后的原理有哪些？ - 韩天峰的回答 - 知乎
https://www.zhihu.com/question/38148900/answer/75115687

# php 的变量以什么数据结构保存在内存里

php 内存分为堆内存、栈内存、代码段、初始化静态段。

**堆空间段：**是存储占用相同空间长度并且占用空间小的数据类型的地方，比如说整型1，10，100，1000，10000，100000 等等，在内存里面占用空间是等长的，都是64 位4 个字节。存储的都是局部变量，凡是定义在方法中的都是局部变量（方法外的是全局变量），变量有自己的作用域，一旦离开作用域，变量就会被释放。栈内存的更新速度很快，因为局部变量的生命周期都很短。所以在栈空间的数据都是可以通过代码手动进行释放。

**栈内存段：**数据长度不定长，而且占有空间很大的数据类型的数据。在堆内存是里是不可以直接存取的内存，堆内存存储的是数组和对象（其实数组就是对象）。凡是new建立的都是在堆中，堆中存放的都是实体（对象），实体用于封装数据，而且是封装多个（实体的多个属性），如果一个数据消失，这个实体也没有消失，还可以用，所以堆是不会随时释放的，但是栈不一样，栈里存放的都是单个变量，变量被释放了，那就没有了。堆里的实体虽然不会被释放，但是会被当成垃圾，最后通过垃圾回收机制去实现垃圾回收。对于我们的对象来数就是一种大的数据类型而且是占用空间不定长的类型，所以说对象是放在堆里面的，但对象名称是放在栈里面的，这样通过对象名称就可以使用对象。

https://cloud.tencent.com/developer/article/1162322

# redis 跳表的数据结构
简单的来说就是自带了一个跳跃的索引，比如数据是123456789，那么跳表的一级索引可以是148，二级索引是14

https://www.jianshu.com/p/d12389b80a19

# 有一个活动预计1000万用户参与，总计10小时，问怎么部署软硬件
1. 假设是一个力度大的活动，80%流量落在前10分钟，即1.4万qps。然后根据压测数据申请服务器，注意预留30%性能
2. 如果不是秒杀场景，可以用令牌桶算法限流。秒杀场景由于是先到先得，可以用消息队列缓存
3. 有资格参加活动的用户和活动奖品可以预先保存在缓存或消息队列里，数据库只保存最终结果
4. 可以用一致性哈希算法对用户token进行计算，那么特定用户只会访问特定业务服务器，这时可以把用户抽奖次数缓存在那台业务服务器上，减轻缓存服务器压力。页面固定数据也可以缓存在各台业务服务器上，避免单key压力
5. 缓存和数据库采用集群缓解压力
